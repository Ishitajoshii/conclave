services:
  sfu-a:
    build:
      context: ./packages/sfu
    network_mode: "host"
    environment:
      SFU_PORT: "3031"
      SFU_INSTANCE_ID: "sfu-a"
      SFU_SECRET: ${SFU_SECRET}
      SFU_DRAINING: "false"
      RTC_MIN_PORT: "40000"
      RTC_MAX_PORT: "41000"
      ANNOUNCED_IP: ${ANNOUNCED_IP}
      PLAIN_TRANSPORT_ANNOUNCED_IP: ${PLAIN_TRANSPORT_ANNOUNCED_IP:-${ANNOUNCED_IP}}
      SFU_VERSION: "v1"
      BROWSER_SERVICE_URL: ${BROWSER_SERVICE_URL:-http://localhost:3040}
      BROWSER_SERVICE_TOKEN: ${BROWSER_SERVICE_TOKEN:-}
      BROWSER_SERVICE_TIMEOUT_MS: ${BROWSER_SERVICE_TIMEOUT_MS:-5000}
    restart: unless-stopped

  sfu-b:
    build:
      context: ./packages/sfu
    network_mode: "host"
    environment:
      SFU_PORT: "3032"
      SFU_INSTANCE_ID: "sfu-b"
      SFU_SECRET: ${SFU_SECRET}
      SFU_DRAINING: "false"
      RTC_MIN_PORT: "41001"
      RTC_MAX_PORT: "42000"
      ANNOUNCED_IP: ${ANNOUNCED_IP}
      PLAIN_TRANSPORT_ANNOUNCED_IP: ${PLAIN_TRANSPORT_ANNOUNCED_IP:-${ANNOUNCED_IP}}
      SFU_VERSION: "v2"
      BROWSER_SERVICE_URL: ${BROWSER_SERVICE_URL:-http://localhost:3040}
      BROWSER_SERVICE_TOKEN: ${BROWSER_SERVICE_TOKEN:-}
      BROWSER_SERVICE_TIMEOUT_MS: ${BROWSER_SERVICE_TIMEOUT_MS:-5000}
    restart: unless-stopped
